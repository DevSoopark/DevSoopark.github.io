{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blockchain/1","result":{"pageContext":{"isCreatedByStatefulCreatePages":false,"html":"<h2>아래 모든 케이스에서 오더 발생 전 유저들의 어카운트 상황은 모두 같음</h2>\n<p>BTC의 fee는 0.0005(0.05%)</p>\n<h1>Case 1. 매도가 먼저 있을 때.</h1>\n<p>firstOrder = askOrder<br/>\nfirstUnit = ask<br/>\nsecondOrder = bidOrder<br/>\nsecondUnit = bid<br/>\nsmallerOrder = min(askOrder.volume, bidOrder.volume) === askOrder.volume ? askOrder : bidOrder</p>\n<h1><em>1-1. 매도의 volume이 더 클 때.</em></h1>\n<ul>\n<li>1st. <em>User1</em>이 <em>ETH</em>를 <em>0.2BTC</em>에 <em>100개</em> <em>매도</em></li>\n<li>2nd. <em>User2</em>가 <em>ETH</em>를 <em>0.3BTC</em>에 <em>80개</em> <em>매수</em></li>\n</ul>\n<h3>오더 발생 전 어카운트 상황</h3>\n<table>\n<thead>\n<tr>\n<th align=\"center\">account</th>\n<th align=\"center\">balance</th>\n<th align=\"center\">locked</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">user1 eth</td>\n<td align=\"center\">400</td>\n<td align=\"center\">100</td>\n</tr>\n<tr>\n<td align=\"center\">user1 btc</td>\n<td align=\"center\">35</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">user2 eth</td>\n<td align=\"center\">300</td>\n<td align=\"center\">200</td>\n</tr>\n<tr>\n<td align=\"center\">user2 btc</td>\n<td align=\"center\">50</td>\n<td align=\"center\">2</td>\n</tr>\n</tbody>\n</table>\n<h3>오더 발생 후 어카운트 상황</h3>\n<table>\n<thead>\n<tr>\n<th align=\"center\">account</th>\n<th align=\"center\">balance</th>\n<th align=\"center\">locked</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">user1 eth</td>\n<td align=\"center\">400 - 100 = 300</td>\n<td align=\"center\">100 + 100 = 200</td>\n</tr>\n<tr>\n<td align=\"center\">user1 btc</td>\n<td align=\"center\">35</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">user2 eth</td>\n<td align=\"center\">300</td>\n<td align=\"center\">200</td>\n</tr>\n<tr>\n<td align=\"center\">user2 btc</td>\n<td align=\"center\">50 - (24 + 0.012) = 25.988</td>\n<td align=\"center\">2 + (24 + 0.012) = 26.012</td>\n</tr>\n</tbody>\n</table>\n<h3>거래 체결 후 어카운트 상황</h3>\n<table>\n<thead>\n<tr>\n<th align=\"center\">account</th>\n<th align=\"center\">balance</th>\n<th align=\"center\">locked</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">user1 eth</td>\n<td align=\"center\">300</td>\n<td align=\"center\">200 - 80 = 120</td>\n</tr>\n<tr>\n<td align=\"center\">user1 btc</td>\n<td align=\"center\">35 + (16 - 0.008) = 50.992</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">user2 eth</td>\n<td align=\"center\">300 + 80 = 380</td>\n<td align=\"center\">200</td>\n</tr>\n<tr>\n<td align=\"center\">user2 btc</td>\n<td align=\"center\">25.988 + (8 + 0.004) = 33.992</td>\n<td align=\"center\">26.012 - (16 + 0.008) - (8 + 0.004) = 2</td>\n</tr>\n</tbody>\n</table>\n<h3>오더 발생 후</h3>\n<p>firstOrder.user.Account.firstUnit.balance -= firstOrder.volume</p>\n<p>firstOrder.user.Account.firstUnit.locked += firstOrder.volume</p>\n<p>secondOrder.user.Account.secondUnit.balance -= secondOrder.volume _ secondOrder.price _ (1 + bidFee)</p>\n<p>secondOrder.user.Account.secondUnit.locked += secondOrder.volume _ secondOrder.price _ (1 + bidFee)</p>\n<h3>거래 체결 후</h3>\n<p>firstOrder.user.Account.firstUnit.locked -= smallerOrder.volume</p>\n<p>firstOrder.user.Account.secondUnit.balance += smallerOrder.volume _ firstOrder.price _ (1 - bidFee)</p>\n<p>secondOrder.user.firstUnit.balance += smallerOrder.volume</p>\n<p>secondOrder.user.secondUnit.balance += (secondOrder.price - firstOrder.price) _ smallerOrder.volume _ (1 + bidFee)</p>\n<p>secondOrder.user.secondUnit.locked -= (smallerOrder.volume _ firstOrder.price _ (1 + bidFee) + (secondOrder.price - firstOrder.price) _ smallerOrder.volume _ (1 + bidFee))</p>\n<h1>1-<em>2. 매수의 volume이 더 클 때.</em></h1>\n<p>1st. <em>User1</em>이 <em>ETH</em>를 <em>0.2BTC</em>에 8<em>0개</em> <em>매도</em>\n2nd. <em>User2</em>가 <em>ETH</em>를 <em>0.3BTC</em>에 <em>100개</em> <em>매수</em></p>\n<p><a href=\"https://www.notion.so/e05530ae5c7f423388fbf9bdf5aab210\">오더 발생 전</a></p>\n<p><a href=\"https://www.notion.so/3cfb346a7c2d4feca567fe9f950e72e1\">오더 발생 후</a></p>\n<p><a href=\"https://www.notion.so/6b645cef40454e5aa5c9d84e9c1f1933\">거래 채결 후</a></p>\n<h3>오더 발생 후</h3>\n<p>firstOrder.user.Account.firstUnit.balance -= firstOrder.volume</p>\n<p>firstOrder.user.Account.firstUnit.locked += firstOrder.volume</p>\n<p>secondOrder.user.Account.secondUnit.balance -= secondOrder.volume _ secondOrder.price _ (1 + bidFee)</p>\n<p>secondOrder.user.Account.secondUnit.locked += secondOrder.volume _ secondOrder.price _ (1 + bidFee)</p>\n<h3>거래 체결 후</h3>\n<p>firstOrder.user.Account.firstUnit.locked -= smallerOrder.volume</p>\n<p>firstOrder.user.Account.secondUnit.balance += smallerOrder.volume _ firstOrder.price _ (1 - bidFee)</p>\n<p>secondOrder.user.firstUnit.balance += smallerOrder.volume</p>\n<p>secondOrder.user.secondUnit.balance += (secondOrder.price - firstOrder.price) _ smallerOrder.volume _ (1 + bidFee)</p>\n<p>secondOrder.user.secondUnit.locked -= (smallerOrder.volume _ firstOrder.price _ (1 + bidFee) + (secondOrder.price - firstOrder.price) _ smallerOrder.volume _ (1 + bidFee))</p>\n<h1>Case 2. 매수가 먼저 있을 때.</h1>\n<p>firstOrder = askOrder</p>\n<p>firstUnit = ask</p>\n<p>secondOrder = bidOrder</p>\n<p>secondUnit = bid</p>\n<p>smallerOrder = min(askOrder.volume, bidOrder.volume) === askOrder.volume ? askOrder : bidOrder</p>\n<h1>2-1<em>. 매수의 volume이 더 클 때.</em></h1>\n<p>1st. <em>User1</em>이 <em>ETH</em>를 <em>0.3BTC</em>에 <em>100개</em> <em>매수</em>\n2nd. <em>User2</em>가 <em>ETH</em>를 <em>0.2BTC</em>에 8<em>0개</em> <em>매도</em></p>\n<p><a href=\"https://www.notion.so/f68acb13ecdc425d99b1452389851382\">오더 발생 전</a></p>\n<p><a href=\"https://www.notion.so/40eb222ae8f541a1b23b4b6a5e3e959b\">오더 발생 후</a></p>\n<p><a href=\"https://www.notion.so/14f6914d542b48e89c8bf5751682f0c3\">거래 채결 후</a></p>\n<h3>오더 발생 후</h3>\n<p>firstOrder.user.Account.secondUnit.balance -= firstOrder.volume _ firstOrder.price _ (1 + bidFee)</p>\n<p>firstOrder.user.Account.secondUnit.locked += fistOrder.volume _ firstOrder.price _ (1 + bidFee)</p>\n<p>secondOrder.user.Account.firstUnit.balance -= secondOrder.volume</p>\n<p>secondOrder.user.Account.firstUnit.locked += secondOrder.volume</p>\n<h3>거래 체결 후</h3>\n<p>firstOrder.user.firstUnit.balance += smallerOrder.volume</p>\n<p>firstOrder.user.secondUnit.locked -= smallerOrder.volume _ firstOrder.price _ (1 + bidFee)</p>\n<p>secondOrder.user.Account.firstUnit.locked -= smallerOrder.volume</p>\n<p>secondOrder.user.Account.secondUnit.balance += smallerOrder.volume _ firstOrder.price _ (1 - bidFee)</p>\n<h1>2-2<em>. 매도의 volume이 더 클 때.</em></h1>\n<p>1st. <em>User1</em>이 <em>ETH</em>를 <em>0.3BTC</em>에 8<em>0개</em> <em>매수</em>\n2nd. <em>User2</em>가 <em>ETH</em>를 <em>0.2BTC</em>에 <em>100개</em> <em>매도</em></p>\n<p><a href=\"https://www.notion.so/0644807fcc67407e8231b2372e3927b2\">오더 발생 전</a></p>\n<p><a href=\"https://www.notion.so/87733583353446d4ad5caf29f754436d\">오더 발생 후</a></p>\n<p><a href=\"https://www.notion.so/0ead8539429447c19d5b6df55bfc8b74\">거래 채결 후</a></p>\n<h3>오더 발생 후</h3>\n<p>firstOrder.user.Account.secondUnit.balance -= firstOrder.volume _ firstOrder.price _ (1 + bidFee)</p>\n<p>firstOrder.user.Account.secondUnit.locked += fistOrder.volume _ firstOrder.price _ (1 + bidFee)</p>\n<p>secondOrder.user.Account.firstUnit.balance -= secondOrder.volume</p>\n<p>secondOrder.user.Account.firstUnit.locked += secondOrder.volume</p>\n<h3>거래 체결 후</h3>\n<p>firstOrder.user.firstUnit.balance += smallerOrder.volume</p>\n<p>firstOrder.user.secondUnit.locked -= smallerOrder.volume _ firstOrder.price _ (1 + bidFee)</p>\n<p>secondOrder.user.Account.firstUnit.locked -= smallerOrder.volume</p>\n<p>secondOrder.user.Account.secondUnit.balance += smallerOrder.volume _ firstOrder.price _ (1 - bidFee)</p>\n<h1>결국, Case1-1과 1-2의 공식은 동일하고, Case2-1과 2-2의 공식도 동일함.</h1>\n<p>Case 1, Case2 만 나누면 되는 것인가.</p>","title":"거래소에서의 잔액 처리 상황에 대한 로직 정리","date":"2019-10-25 11:00:02","excerpt":"아래 모든 케이스에서 오더 발생 전 유저들의 어카운트 상황은 모두 같음 BTC의 fee는 0.0005(0.05%) Case 1. 매도가 먼저 있을 때. firstOrder = askOrder\nfirstUnit = ask\nsecondOrder = bidOrder\nsecondUnit = bid\nsmallerOrder = min(askOrder.volume, …"}}}