<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.6c0b711e3a19c934d5fd.css">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}@font-face{font-family:BMHANNAAir;src:url(https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_four@1.0/BMHANNAAir.woff) format("woff");font-weight:400;font-style:normal}</style><meta name="generator" content="Gatsby 2.18.4"/><title data-react-helmet="true"></title><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="shortcut icon" href="/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=008654519ce705ac7bc44303a9014606"/><link as="script" rel="preload" href="/styles-cee0c110ada47038393d.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-tsx-2419b1d49e477d8e0333.js"/><link as="script" rel="preload" href="/commons-b611e3f38646a3b9704e.js"/><link as="script" rel="preload" href="/app-4e364b803d2464eb69f2.js"/><link as="script" rel="preload" href="/webpack-runtime-cf368acd37c68dcb6d26.js"/><link as="fetch" rel="preload" href="/page-data/web/1/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="sc-bwzfXH eiUrLC"><div class="sc-bwzfXH ibZqjo"><div display="flex" class="sc-bwzfXH dqWvaD"><div display="flex" class="sc-bwzfXH cXYEDy"><a style="color:#1E1E1E;text-decoration:none;font-size:2.1rem;font-family:BMHANNAAir;font-weight:bold" href="/">민수르 블로그</a></div></div></div><button display="flex" width="1.5rem" height="1.5rem" class="sc-bdVaJa dJghfC"><div class="sc-bwzfXH igTEBu"></div><div class="sc-bwzfXH igTEBu"></div><div class="sc-bwzfXH igTEBu"></div></button><nav width="19rem" display="flex" height="100vh" class="sc-htpNat jBnjAl"><div class="sc-bwzfXH ccoWXv"><div><a style="color:#1E1E1E;font-size:1.3rem;font-family:BMHANNAAir;font-weight:bold" href="/"><div class="sc-bwzfXH igTEBu">분류 전체(Total) (6)</div></a></div></div><div class="sc-bwzfXH ccoWXv"><div><a style="color:#1E1E1E;font-size:1.3rem;font-family:BMHANNAAir;font-weight:bold" href="/?category=devlog"><div class="sc-bwzfXH igTEBu">개발(Devlog) (5)</div></a></div></div><div class="sc-bwzfXH dRvNft"><div><a style="color:#1E1E1E;font-size:1.1rem;font-family:BMHANNAAir;text-decoration:none" href="/?category=web"><div class="sc-bwzfXH igTEBu">웹(Web) (2)</div></a></div></div><div class="sc-bwzfXH dRvNft"><div><a style="color:#1E1E1E;font-size:1.1rem;font-family:BMHANNAAir;text-decoration:none" href="/?category=react"><div class="sc-bwzfXH igTEBu">리액트(React) (2)</div></a></div></div><div class="sc-bwzfXH dRvNft"><div><a style="color:#1E1E1E;font-size:1.1rem;font-family:BMHANNAAir;text-decoration:none" href="/?category=blockchain"><div class="sc-bwzfXH igTEBu">블록체인(Blockchain) (1)</div></a></div></div><div class="sc-bwzfXH ccoWXv"><div><a style="color:#1E1E1E;font-size:1.3rem;font-family:BMHANNAAir;font-weight:bold" href="/?category=lifelog"><div class="sc-bwzfXH igTEBu">생각(Lifelog) (1)</div></a></div></div></nav><button display="flex" class="sc-bdVaJa hCHJsI"><div font-family="BMHANNAAir" font-size="1.19rem" font-weight="bold" color="#1E1E1E" class="sc-bwzfXH kGEHuX">Light</div></button><div class="sc-bwzfXH gTGfeW"><main><div font-family="BMHANNAAir" font-size="1.8em" font-weight="bold" class="sc-bwzfXH cHHAyX">WebSocket을 이용한 WebSocket Server 구현</div><div font-family="BMHANNAAir" font-size="0.9em" color="#808080" class="sc-bwzfXH fPWaHf">2019-10-25 11:00:03</div><hr/><div class="sc-bwzfXH jZjjCY"><div style="font-family:godic;color:#1E1E1E"><h2>고민거리</h2>
<ol>
<li>
<p>클라이언트에서 서버랑 소켓 연결한 뒤 메세지 보내고 가만히 있으면 계속 메세지를 수신하는데, 그렇다는 건 서버에서 메세지 내려주는 시기를 정해야 된다는 것. 그렇다면, 그 시기를 어떻게 잡을까?</p>
<p><strong><em>→ 웹소켓 서버가 레디스를 섭스크라이브하고 있어서 데몬이 그 레디스에 퍼블리쉬 할 때, 웹소켓 서버는 레디스 채널에 퍼블리쉬 된 정보가 어떤 종류(ticket, orderbook, trade)고 어떤 마켓(btcusd 등)인지 판단해서 해당하는 메세지 요청했던 클라이언트한테 전부 해당 메세지를 보내줘야 된다고 판단함.</em></strong></p>
</li>
<li>
<p>그 메세지를 요청한 클라이언트들 파악은 어떻게?</p>
<p><strong><em>→ 클라이언트에서 서버와 소켓 커넥팅 한 뒤, 메세지를 요청하면 어떤 클라이언트가 어떤 메세지들을 요청했는지 리스트에 추가하여 상태(리스트) 유지. (리스트는 크게 두가지로 구성함. 레디스 채널명을 key로 하고 클라이언트(ip, socket)를 value로 하는 Map 하나랑, 클라이언트(ip, socket)를 key로 하고 해당 클라가 요청한 메시지들을 value로 하는 Map 하나.)</em></strong></p>
</li>
<li>
<p>상태를 유지하는 게 맞는가? 아니라면 어떻게 해야 할까?</p>
<p><strong><em>→ 딱히 방법이 떠오르지 않음. 이렇게 한다라고 했을 때, 더 고민해 볼 거리는 상태를 레디스나 디비로 관리할 지 정도? (redis subscribe가 아마 정말 빈번하게 발생될 거라 생각해서 오버헤드가 걱정돼서 지금은 이걸 변수로 뒀음)</em></strong></p>
</li>
<li>
<p>데몬들이 redis에 publish 했을 때, 웹소켓 서버가 subscribe하려면 레디스 채널들 전부 subscribe하고 있어햐 됨. 지금은 서버 시작할 때, 미리 정의 해놓은 배열(socket type이랑 market) 돌면서 모든 채널들에 대해서 subscribe를 전부 실행시킴. 근데 이렇게 되면 새로운 코인 상장할 때 서버를 껐다 켜야되는 문제가 있음.</p>
<p><strong><em>→ 채널들 리프레쉬 시키는 api 하나 구현해서 관리자가 상장할때 웹소켓 서버에 이 api 호출 시켜야 하나..? socket type이랑 market들을 상수가 아니라 디비에 넣어놓고..? 일단 구현하지 않고 MR 보내논 상태.</em></strong></p>
</li>
</ol></div><div></div></div></main><footer></footer></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/web/1";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-4e364b803d2464eb69f2.js"],"component---src-templates-post-template-tsx":["/component---src-templates-post-template-tsx-2419b1d49e477d8e0333.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-baebb0389b950ca54f3a.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-cd5fbadbdf6b1e19ec11.js"]};/*]]>*/</script><script src="/webpack-runtime-cf368acd37c68dcb6d26.js" async=""></script><script src="/app-4e364b803d2464eb69f2.js" async=""></script><script src="/commons-b611e3f38646a3b9704e.js" async=""></script><script src="/component---src-templates-post-template-tsx-2419b1d49e477d8e0333.js" async=""></script><script src="/styles-cee0c110ada47038393d.js" async=""></script></body></html>