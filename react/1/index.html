<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.6c0b711e3a19c934d5fd.css">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}@font-face{font-family:BMHANNAAir;src:url(https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_four@1.0/BMHANNAAir.woff) format("woff");font-weight:400;font-style:normal}</style><meta name="generator" content="Gatsby 2.18.4"/><title data-react-helmet="true"></title><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="shortcut icon" href="/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=008654519ce705ac7bc44303a9014606"/><link as="script" rel="preload" href="/styles-cee0c110ada47038393d.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-tsx-2419b1d49e477d8e0333.js"/><link as="script" rel="preload" href="/commons-b611e3f38646a3b9704e.js"/><link as="script" rel="preload" href="/app-4e364b803d2464eb69f2.js"/><link as="script" rel="preload" href="/webpack-runtime-cf368acd37c68dcb6d26.js"/><link as="fetch" rel="preload" href="/page-data/react/1/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="sc-bwzfXH eiUrLC"><div class="sc-bwzfXH ibZqjo"><div display="flex" class="sc-bwzfXH dqWvaD"><div display="flex" class="sc-bwzfXH cXYEDy"><a style="color:#1E1E1E;text-decoration:none;font-size:2.1rem;font-family:BMHANNAAir;font-weight:bold" href="/">민수르 블로그</a></div></div></div><button display="flex" width="1.5rem" height="1.5rem" class="sc-bdVaJa dJghfC"><div class="sc-bwzfXH igTEBu"></div><div class="sc-bwzfXH igTEBu"></div><div class="sc-bwzfXH igTEBu"></div></button><nav width="19rem" display="flex" height="100vh" class="sc-htpNat jBnjAl"><div class="sc-bwzfXH ccoWXv"><div><a style="color:#1E1E1E;font-size:1.3rem;font-family:BMHANNAAir;font-weight:bold" href="/"><div class="sc-bwzfXH igTEBu">분류 전체(Total) (6)</div></a></div></div><div class="sc-bwzfXH ccoWXv"><div><a style="color:#1E1E1E;font-size:1.3rem;font-family:BMHANNAAir;font-weight:bold" href="/?category=devlog"><div class="sc-bwzfXH igTEBu">개발(Devlog) (5)</div></a></div></div><div class="sc-bwzfXH dRvNft"><div><a style="color:#1E1E1E;font-size:1.1rem;font-family:BMHANNAAir;text-decoration:none" href="/?category=web"><div class="sc-bwzfXH igTEBu">웹(Web) (2)</div></a></div></div><div class="sc-bwzfXH dRvNft"><div><a style="color:#1E1E1E;font-size:1.1rem;font-family:BMHANNAAir;text-decoration:none" href="/?category=react"><div class="sc-bwzfXH igTEBu">리액트(React) (2)</div></a></div></div><div class="sc-bwzfXH dRvNft"><div><a style="color:#1E1E1E;font-size:1.1rem;font-family:BMHANNAAir;text-decoration:none" href="/?category=blockchain"><div class="sc-bwzfXH igTEBu">블록체인(Blockchain) (1)</div></a></div></div><div class="sc-bwzfXH ccoWXv"><div><a style="color:#1E1E1E;font-size:1.3rem;font-family:BMHANNAAir;font-weight:bold" href="/?category=lifelog"><div class="sc-bwzfXH igTEBu">생각(Lifelog) (1)</div></a></div></div></nav><button display="flex" class="sc-bdVaJa hCHJsI"><div font-family="BMHANNAAir" font-size="1.19rem" font-weight="bold" color="#1E1E1E" class="sc-bwzfXH kGEHuX">Light</div></button><div class="sc-bwzfXH gTGfeW"><main><div font-family="BMHANNAAir" font-size="1.8em" font-weight="bold" class="sc-bwzfXH cHHAyX">Hooks와 함께 MobX 사용하기</div><div font-family="BMHANNAAir" font-size="0.9em" color="#808080" class="sc-bwzfXH fPWaHf">2019-08-08 12:20:00</div><hr/><div class="sc-bwzfXH jZjjCY"><div style="font-family:godic;color:#1E1E1E"><h2>리액트가 변하고 있다(?)</h2>
<p>React 가 Hook을 내장시킴에 따라 많은 라이브러리들이 Hooks API 를 지원하고 있습니다.</p>
<blockquote>
<p>어차피 5-6개월 있으면 또 새로운 거 나와서 다시 새로 배워야 되는거 아냐?
도대체 Hook이 뭔데?</p>
</blockquote>
<p>Hook은 state와 LifeCycle을 관리하는 새로운 방법입니다. Class Component에서는 사용할 수 없으며, Functional Component에서만 사용해야 합니다.</p>
<p>Functional Component는 Class Component에 비해 초기 마운트가 미세하게 빠르고, 메모리 소모량이 적습니다.</p>
<p>하지만, 초기 마운트가 빠르고, 메모리 소모량이 적을 수 있는 이유는 state 와 LifeCycle 등의 기능이 없어서이기 때문에, state를 가져야 하는 컴포넌트는 함수형으로 만들 수가 없었습니다.</p>
<p>React가 내놓은 Hooks가 바로 Functional Component에서 state와 LifeCycle을 관리할 수 있게 해주는 녀석입니다.</p>
<p>많은 라이브러리에서 Hook을 지원하려는 걸 보면서 많은 개발자들이 Class Component보다 Functional Component를 더 선호하고 둘의 차이를 좁히기 위해 노력하고 있다고 느낍니다.</p>
<p>점점 더 많은 프로젝트들이 Hook과 함께 Functional Component 기반으로 migration 될 것이고, 변하고 있는 이 흐름은 공부할 가치가 충분하다고 생각합니다.</p>
<hr>
<h2>Redux, MobX 에서도?</h2>
<h3>react-redux는 v7.1 부터 mobx-react는 v6 부터 hook API를 지원하고 있습니다.</h3>
<blockquote>
<p>Redux와 MobX는 React의 특성인 단방향 바인딩(데이터의 흐름이 단방향으로 흐르는)에 의해 생길 수 있는 여러 단점들을 해결하기 위해, Context 를 생성하여 데이터를 트리 단위로 주입하여 데이터를 전역적으로 관리할 수 있는 라이브러리이며, React에 내장된 Context API를 기반으로 구현이 되어있습니다. (React에 Context API가 도입된 이후 mobx-react는 injection pattern을 Context API 기반으로 migration 할 것을 권장하고 있습니다.)</p>
</blockquote>
<h3>Context API란?</h3>
<p>다음 두 예시의 차이를 들어 Context API에 대해 좀 더 자세히 설명하겠습니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 400px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/33475ba555729d9aa721b6cd63245855/b4624/tree1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 96.57894736842105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAACwUlEQVQ4y41US2sTURQe9y5EN7oUVxUL2h/gxo0bBZe6ElwpxaV04abLYnGhSFeFgtSCUPEBItg8EJtqH5kkM0lNk07eD0zShiSdTOZO8nkfM9M0GcVLMnPn3Hu++53vnHskeIzBYIB+v8/n+5qGTCaLYrGERGLXXWd/ryF5gQ0DqvE4dL3L54qqjgGOAkvDQPTJfwyMEJPbk3sprIc28OPnJqKxGLcRQvgeL1BPhs44PGwipigwTROGYXCGBwcHY9H8laGzmNgP4+vmW6xvhCiTYwfGirGVIxGk0mlPEtJoEnIFDQv+R3j5/S5WfM8xsJgKwqHX6yESjcGgb5aobDZnH3RMZgxQy+3hVfABFqP38SYwB9KD0JaObrfLAU2qoaZlkM8XXOYuoBOqY6iUf+OjbxnvQwv4FgrasVqUKeHTeqNBM5+Azx9AY0TPMQ3b7TbXxxnlcgXJVIrzszyStxOWOWsmhWPjgEwPlk1/IMg3sGHZjHa2t7E+Mw1lfhbtzpFYI8StgjWfH6oaRzYn9JRarRbCsmAVjSlg3zxK2yn8Yg6lidMoTJ5BfHlRAJqiRgvFInL5vNhHMViEkq7r/IPVWViW0el0TjipK0tITp7F7tR5aGuf7TVxWK1eR5zq6UjF6pWH3KBCs+zVajXBzi4rQixsRWJIflqFvLqCeCo9VJPiXa1WuVwdWw7J+5L3qE5dJH+p9JC6a01RwHIpA2Lq7DjPpuLWoWWJPDabTdx5rOLizTA+fBHamgY7gFHq4+mzAM5dj2BmPsJBGdMTdeigEyJieP1OgTRRh3QZuPckycoZxK4Z/aiFCzfikK4Cp64lUSrX3JsydpcdY1qr4NKtPUhTBSytCs2INbB1JXg4q0K6UsXtaZUWu/HvbuOAlis1KLsFHuJo47CIgS05Q3vk0f/0w5P0mWnYYdTZqx/+AfZmkKd/evzFAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Tree1"
        title="Tree1"
        src="/static/33475ba555729d9aa721b6cd63245855/7c2ef/tree1.png"
        srcset="/static/33475ba555729d9aa721b6cd63245855/94c5f/tree1.png 100w,
/static/33475ba555729d9aa721b6cd63245855/563d8/tree1.png 200w,
/static/33475ba555729d9aa721b6cd63245855/7c2ef/tree1.png 400w,
/static/33475ba555729d9aa721b6cd63245855/7aa3b/tree1.png 600w,
/static/33475ba555729d9aa721b6cd63245855/b4624/tree1.png 760w"
        sizes="(max-width: 400px) 100vw, 400px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>초록색의 컴포넌트의 state를 파란색의 컴포넌트들에서 사용하려고 하면, 초록색에서 파란색들한테 props를 넘겨주기 위해 중간에 그 props가 필요 없는 빨간색의 컴포넌트에까지 props를 전달해주어야 합니다. 이러한 방식에서 트리의 level이 깊어질수록 불편함은 커집니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 400px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/15dd73d757e4a334523bd289bd377c0a/b4624/tree2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 96.57894736842105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAADU0lEQVQ4y3VUzWsbRxSf/A099RgolJxKCeTWS0+9ldBb6aH0lkvpKVDouRR6CCWE9hIo9DsQ3IRA29SSjS3LkhxLu9pdS7uSVt+yK8drSZa02s9f387s+iNSHszO7JuZ936/9zEMKyQMQwRBwNcN00Sz2UKv18fBQeV8PxqrhF0+cHkEvscPqJqG+dzma0VVlwy+aphd3ghjVNHXiw/oDRM7O1nk8gXI5TLXeZ7HGawyypY8ug4w/A/EE+PSHpTcLlzSLxYLKIoKyzq9EprXIozE1YoIigUom4/xz8ZD5J//BVfeQ1DTBHI6u5PNoiRJqNXrVwwvIbQz60CljHa/hR8yX+D+7if4bfM7QbHTgCvl4RBViWhHaKNEtVpt4Si4QMoNuso+3F6LK8y2gQfpz/BQ+hS/pr+BZ8dxPexiUshArlThui5Ms4lOpxsbvIgnC0YWHDKYyOFgiKepX/Bn9ntsZTcTTmJqN3C0nYJm1JFKpXFiWUu0mVevAqcv+c/ZZMLjk8hgcATdMDgl33UFmgad75p8vb+/D9u24TjOuVHmH0hoKGWUqWhT6Q1+IBI/EIVTLJaQLxR4DUYOI7GLu8DYwmg6w/p6CqqqodUW8WQnO2lCJfMfuaxgEl9KKKjaAa+76WwGWRZ16C9shHIB3W4X7U5HOC5JODs7AxvntlCq6LDnc1KWMJ1OxSXf53NZUdDr93kS6vWG2OPB7uIol4FGuiRUUbKYrxZhzWxI5OH4+DiuNxFDzw/wguJUrep8rlCGE4lyH9DdQ0JYJsoJEOaUcita3IHv2dCrKo5fnpxra4Rm0G/CW8QsDOrt8dXOYZ6uwiP4otpCjEYj3P5cxfUPinjyt8i463qUpJDj+urbDbzxnoQv7ylUHQM4usbvJu8Ai3rXeZEhryL1P62pYG8PwW4AH9/Vo5wSdYFgPh3jzfdp/x3g2s0aeiZlVpcRXjbI43F6Aju/TR6HqBldvPVRB+zWEX5cE/Xmh0DSrXe+NsDetfDh3SbchgrfNAS3c4TxgiOtEg1DRjv1L6TnW/TEjBFGJWLPEUypnKwhnLqK3d+fYLK3jbAqLT1h8eMQXGSPMovFDGhVMX/2CPO1n/mwn/2BRTYNn9oPLu2Tg3DFa/M/CRaFZ/SkJakAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Tree2"
        title="Tree2"
        src="/static/15dd73d757e4a334523bd289bd377c0a/7c2ef/tree2.png"
        srcset="/static/15dd73d757e4a334523bd289bd377c0a/94c5f/tree2.png 100w,
/static/15dd73d757e4a334523bd289bd377c0a/563d8/tree2.png 200w,
/static/15dd73d757e4a334523bd289bd377c0a/7c2ef/tree2.png 400w,
/static/15dd73d757e4a334523bd289bd377c0a/7aa3b/tree2.png 600w,
/static/15dd73d757e4a334523bd289bd377c0a/b4624/tree2.png 760w"
        sizes="(max-width: 400px) 100vw, 400px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Context를 생성하고, 해당 Context의 value(어떤 데이터(store, state 등)를 사용할 지)를 정합니다.
빨간색의 원 구역만큼의 트리를 해당 Context의 Provider로 감싸주면, Provider의 영역 안에 있는 컴포넌트라면 어떤 컴포넌트든 Context의 Consumer를 통해 Context의 value를 구독할 수 있습니다.(Hook의 useContext로 Consumer를 대체할 수 있음)
즉, 초록색과 파란색 사이의 컴포넌트는 건너 뛰고 파란색 컴포넌트들에서 바로 Consumer(or useContext)를 이용하여 Context의 value를 사용할 수 있습니다.</p>
<hr>
<h2>MobX with Hooks</h2>
<h3>Hook을 지원하는 mobx-react-lite가 mobx-react에 v6 부터 내장되었습니다.</h3>
<h3>설치</h3>
<pre><code>npm install mobx mobx-react-lite(or ~v6 mobx-react)
or
yarn add mobx mobx-react-lite(or ~v6 mobx-react)
</code></pre>
<h3>Store 구현 코드</h3>
<p>다음과 같이 Store를 구현합니다.</p>
<pre><code>// ~store/tokenStore.tsx

export type TToken = {
  symbol: string,
  balance: number
}

export function tokenStore() {
  return {
    tokenList: [{symbol: "BTC", balance: 0}] as TToken[],
    addToken(token: TToken) {
      this.tokenList = [...this.tokenList, token];
    },
    get totalBalance() {
      return this.tokenList.reduce((prev, current) => {
        return prev + current.balance
      }, 0);
    }
  };
}

export type TTokenStore = ReturnType&#x3C;typeof tokenStore>
</code></pre>
<h3>Context 구현 코드</h3>
<p>위에서 구현한 Store를 mobx-react-lite의 useLocalStore를 사용하여 진짜 Store로 만들고, 생성한 Context Provider value에 넣어줍니다.</p>
<p>useLocalStore는 내부 리소스를 observable 하게 만들어 줍니다.</p>
<pre><code>// ~store/useTokenStore.tsx

import React from 'react'
import { tokenStore, TTokenStore } from './tokenStore'
import { useLocalStore } from 'mobx-react-lite'

const tokenStoreContext = React.createContext&#x3C;TTokenStore | null>(null);

interface ITokenStoreProvider {
  children: JSX.Element
};

export const TokenStoreProvider = (props: ITokenStoreProvider) => {
  const store = useLocalStore(tokenStore);

  return (
    &#x3C;tokenStoreContext.Provider value={store}>
      {props.children}
    &#x3C;/tokenStoreContext.Provider>
  );
};

export const useTokenStore = () => {
  const store = React.useContext(tokenStoreContext);

  if (!store) {
    throw new Error('You have forgot to use StoreProvider, shame on you.');
  }

  return store;
};
</code></pre>
<h3>Store 생성 코드</h3>
<p>다음과 같이 useTokenStore()를 호출하여 구현해 놓은 Store를 생성합니다.</p>
<pre><code>import { useTokenStore } from "../store/useTokenStore";
import { useObserver } from "mobx-react-lite";

const TokenComponent = () => {
  const store = useTokenStore();

  return useObserver(() => (
    ...
  ));
}
</code></pre>
<h3>Store Provider</h3>
<p>마지막으로, 위에서처럼 TokenComponent 에서 (내부에 useContext(tokenStoreContext)로 구현되어 있는) useTokenStore를 사용할 수 있으려면, TokenComponent를 (내부에 tokenStoreContext.Provider로 구현되어 있는) TokenStoreProvider로 감싸줘야합니다.</p>
<pre><code>import { TokenStoreProvider } from "../store/useTokenStore";

export const App = () => {
  return (
    &#x3C;TokenStoreProvider>
      &#x3C;TokenComponent />
    &#x3C;/TokenStoreProvider>
  )
}
</code></pre>
<blockquote>
<p>잠깐, Store를 생성할 때, inject 없이 useTokenStore()로 생성하네요?</p>
</blockquote>
<p>store injection pattern은 React에 Context API 가 도입되기 이전의 Legacy Context를 사용하기에 불편한 점이 많아 도입되었으며, mobx-react 라이브러리에 의해 대중화되었습니다.</p>
<p>하지만, 지금은 Context API 등 Legacy Context를 대체할 수 있는 더 좋은 툴이 많기 때문에, mobx-react 공식문서에서는 injection pattern을 obsolete(더 이상 쓸모 없는)한 것으로 간주하고 migration 할 것을 권장하고 있습니다.</p>
<blockquote>
<p>그러고보니 observable, computed, action 등도 안보이네요?</p>
</blockquote>
<p>현재 mobx-react-lite에 useObservable, useComputed 가 내장되어 있지만, github mobx-react-lite repo를 보면 이 둘 대신에 useLocalStore를 사용하라고 합니다. (곧 없어질 것 같네요.)</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 400px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/bef4a1c00ecc2d8c1c19494257b5dd18/70bf2/image1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 18.201284796573873%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAA40lEQVQY02WP2WqEUBBE/f+/Ctke1FHHGaKOjvss1yVk3BU8uZFAHtJQ0F0Fp2glimMM0+JwPBInCUmaYtk2fhAQRtHm+cEZx3U5hyHeyWdvH3C9E1GcUNX15hdliSgKFFXTeXp+4fXtHdOy+HDc7Tbk7njeBjatPbphSIiHvtNRVRXD2KHpGmmWEUhgkmaUVYUyzwvjNDGOE/Oy8GjabX80DU3bblnb9XQ/6ke6GYYFvgboJ/6NUtWfXG8CIUruopBvpLItl80XYtla/+ZZfuVeVCRiIC9H/EvPreokYmVd//QNVX8nRy4dX8AAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image1"
        title="image1"
        src="/static/bef4a1c00ecc2d8c1c19494257b5dd18/7c2ef/image1.png"
        srcset="/static/bef4a1c00ecc2d8c1c19494257b5dd18/94c5f/image1.png 100w,
/static/bef4a1c00ecc2d8c1c19494257b5dd18/563d8/image1.png 200w,
/static/bef4a1c00ecc2d8c1c19494257b5dd18/7c2ef/image1.png 400w,
/static/bef4a1c00ecc2d8c1c19494257b5dd18/7aa3b/image1.png 600w,
/static/bef4a1c00ecc2d8c1c19494257b5dd18/67d59/image1.png 800w,
/static/bef4a1c00ecc2d8c1c19494257b5dd18/70bf2/image1.png 934w"
        sizes="(max-width: 400px) 100vw, 400px"
        loading="lazy"
      />
  </a>
    </span></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 400px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/fe62c3cb4a551dd5d7a5f725150b104d/038c9/image2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 11.944091486658195%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAeklEQVQI1yWL2w6DIABD/f8PnHjdRXETWLKBCDMmZ4gPTZv2tJiVohQCUdc0bUfX9xydNgZjNErNiKpiGCV103IpT7a/3tLv7A9+lBPWOQprHXJ6Zt0fQx6U1gkyvN4eqT2fryXGiPcetywsyf265hxCYNu2tP/Y950/dyiVIEG791cAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image2"
        title="image2"
        src="/static/fe62c3cb4a551dd5d7a5f725150b104d/7c2ef/image2.png"
        srcset="/static/fe62c3cb4a551dd5d7a5f725150b104d/94c5f/image2.png 100w,
/static/fe62c3cb4a551dd5d7a5f725150b104d/563d8/image2.png 200w,
/static/fe62c3cb4a551dd5d7a5f725150b104d/7c2ef/image2.png 400w,
/static/fe62c3cb4a551dd5d7a5f725150b104d/7aa3b/image2.png 600w,
/static/fe62c3cb4a551dd5d7a5f725150b104d/67d59/image2.png 800w,
/static/fe62c3cb4a551dd5d7a5f725150b104d/038c9/image2.png 1574w"
        sizes="(max-width: 400px) 100vw, 400px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>useLocalStore는 Component instance 당 한 번만 생성되며, 재생성 되도록 강제할 수 없습니다.</p>
<p>또한, 위의 예제처럼 React Context의 도움을 받아 component tree를 이동하며 전역 상태로 관리될 수 있습니다.</p>
<hr>
<h2>Reference</h2>
<ul>
<li><a href="https://boxfoxs.tistory.com/395">https://boxfoxs.tistory.com/395</a></li>
<li><a href="https://github.com/mobxjs/mobx-react">https://github.com/mobxjs/mobx-react</a></li>
<li><a href="https://github.com/mobxjs/mobx-react-lite">https://github.com/mobxjs/mobx-react-lite</a></li>
<li><a href="https://mobx-react.js.org/">https://mobx-react.js.org/</a></li>
<li><a href="https://dev.to/davidyushkov/mobx-and-react-hooks-getting-started-4ff2">https://dev.to/davidyushkov/mobx-and-react-hooks-getting-started-4ff2</a></li>
<li><a href="https://blog.rhostem.com/posts/2019-07-22-mobx-v6-and-react-v16-8">https://blog.rhostem.com/posts/2019-07-22-mobx-v6-and-react-v16-8</a></li>
</ul></div><div></div></div></main><footer></footer></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/react/1";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-4e364b803d2464eb69f2.js"],"component---src-templates-post-template-tsx":["/component---src-templates-post-template-tsx-2419b1d49e477d8e0333.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-baebb0389b950ca54f3a.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-cd5fbadbdf6b1e19ec11.js"]};/*]]>*/</script><script src="/webpack-runtime-cf368acd37c68dcb6d26.js" async=""></script><script src="/app-4e364b803d2464eb69f2.js" async=""></script><script src="/commons-b611e3f38646a3b9704e.js" async=""></script><script src="/component---src-templates-post-template-tsx-2419b1d49e477d8e0333.js" async=""></script><script src="/styles-cee0c110ada47038393d.js" async=""></script></body></html>