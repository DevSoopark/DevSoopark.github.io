{"data":{"markdownRemark":{"frontmatter":{"title":"Hooks와 함께 MobX 사용하기","date":"08 August 2019","path":"/react/1","author":null,"excerpt":null,"tags":["react","hooks","mobx","web"],"coverImage":null},"id":"4c28185e-8a20-5316-8655-c4438659abd9","html":"<h2>리액트가 변하고 있다(?)</h2>\n<p>React 가 Hook을 내장시킴에 따라 많은 라이브러리들이 Hooks API 를 지원하고 있습니다.</p>\n<blockquote>\n<p>어차피 5-6개월 있으면 또 새로운 거 나와서 다시 새로 배워야 되는거 아냐?\n도대체 Hook이 뭔데?</p>\n</blockquote>\n<p>Hook은 state와 LifeCycle을 관리하는 새로운 방법입니다. Class Component에서는 사용할 수 없으며, Functional Component에서만 사용해야 합니다.</p>\n<p>Functional Component는 Class Component에 비해 초기 마운트가 미세하게 빠르고, 메모리 소모량이 적습니다.</p>\n<p>하지만, 초기 마운트가 빠르고, 메모리 소모량이 적을 수 있는 이유는 state 와 LifeCycle 등의 기능이 없어서이기 때문에, state를 가져야 하는 컴포넌트는 함수형으로 만들 수가 없었습니다.</p>\n<p>React가 내놓은 Hooks가 바로 Functional Component에서 state와 LifeCycle을 관리할 수 있게 해주는 녀석입니다.</p>\n<p>많은 라이브러리에서 Hook을 지원하려는 걸 보면서 많은 개발자들이 Class Component보다 Functional Component를 더 선호하고 둘의 차이를 좁히기 위해 노력하고 있다고 느낍니다.</p>\n<p>점점 더 많은 프로젝트들이 Hook과 함께 Functional Component 기반으로 migration 될 것이고, 변하고 있는 이 흐름은 공부할 가치가 충분하다고 생각합니다.</p>\n<hr>\n<h2>Redux, MobX 에서도?</h2>\n<h3>react-redux는 v7.1 부터 mobx-react는 v6 부터 hook API를 지원하고 있습니다.</h3>\n<blockquote>\n<p>Redux와 MobX는 React의 특성인 단방향 바인딩(데이터의 흐름이 단방향으로 흐르는)에 의해 생길 수 있는 여러 단점들을 해결하기 위해, Context 를 생성하여 데이터를 트리 단위로 주입하여 데이터를 전역적으로 관리할 수 있는 라이브러리이며, React에 내장된 Context API를 기반으로 구현이 되어있습니다. (React에 Context API가 도입된 이후 mobx-react는 injection pattern을 Context API 기반으로 migration 할 것을 권장하고 있습니다.)</p>\n</blockquote>\n<h3>Context API란?</h3>\n<p>다음 두 예시의 차이를 들어 Context API에 대해 좀 더 자세히 설명하겠습니다.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/33475ba555729d9aa721b6cd63245855/b4624/tree1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 760px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 96.57894736842105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAACwUlEQVQ4y41US2sTURQe9y5EN7oUVxUL2h/gxo0bBZe6ElwpxaV04abLYnGhSFeFgtSCUPEBItg8EJtqH5kkM0lNk07eD0zShiSdTOZO8nkfM9M0GcVLMnPn3Hu++53vnHskeIzBYIB+v8/n+5qGTCaLYrGERGLXXWd/ryF5gQ0DqvE4dL3L54qqjgGOAkvDQPTJfwyMEJPbk3sprIc28OPnJqKxGLcRQvgeL1BPhs44PGwipigwTROGYXCGBwcHY9H8laGzmNgP4+vmW6xvhCiTYwfGirGVIxGk0mlPEtJoEnIFDQv+R3j5/S5WfM8xsJgKwqHX6yESjcGgb5aobDZnH3RMZgxQy+3hVfABFqP38SYwB9KD0JaObrfLAU2qoaZlkM8XXOYuoBOqY6iUf+OjbxnvQwv4FgrasVqUKeHTeqNBM5+Azx9AY0TPMQ3b7TbXxxnlcgXJVIrzszyStxOWOWsmhWPjgEwPlk1/IMg3sGHZjHa2t7E+Mw1lfhbtzpFYI8StgjWfH6oaRzYn9JRarRbCsmAVjSlg3zxK2yn8Yg6lidMoTJ5BfHlRAJqiRgvFInL5vNhHMViEkq7r/IPVWViW0el0TjipK0tITp7F7tR5aGuf7TVxWK1eR5zq6UjF6pWH3KBCs+zVajXBzi4rQixsRWJIflqFvLqCeCo9VJPiXa1WuVwdWw7J+5L3qE5dJH+p9JC6a01RwHIpA2Lq7DjPpuLWoWWJPDabTdx5rOLizTA+fBHamgY7gFHq4+mzAM5dj2BmPsJBGdMTdeigEyJieP1OgTRRh3QZuPckycoZxK4Z/aiFCzfikK4Cp64lUSrX3JsydpcdY1qr4NKtPUhTBSytCs2INbB1JXg4q0K6UsXtaZUWu/HvbuOAlis1KLsFHuJo47CIgS05Q3vk0f/0w5P0mWnYYdTZqx/+AfZmkKd/evzFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Tree1\"\n        title=\"\"\n        src=\"/static/33475ba555729d9aa721b6cd63245855/b4624/tree1.png\"\n        srcset=\"/static/33475ba555729d9aa721b6cd63245855/563d8/tree1.png 200w,\n/static/33475ba555729d9aa721b6cd63245855/7c2ef/tree1.png 400w,\n/static/33475ba555729d9aa721b6cd63245855/b4624/tree1.png 760w\"\n        sizes=\"(max-width: 760px) 100vw, 760px\"\n      />\n  </span>\n  </a></p>\n<p>초록색의 컴포넌트의 state를 파란색의 컴포넌트들에서 사용하려고 하면, 초록색에서 파란색들한테 props를 넘겨주기 위해 중간에 그 props가 필요 없는 빨간색의 컴포넌트에까지 props를 전달해주어야 합니다. 이러한 방식에서 트리의 level이 깊어질수록 불편함은 커집니다.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/15dd73d757e4a334523bd289bd377c0a/b4624/tree2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 760px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 96.57894736842105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAADU0lEQVQ4y3VUzWsbRxSf/A099RgolJxKCeTWS0+9ldBb6aH0lkvpKVDouRR6CCWE9hIo9DsQ3IRA29SSjS3LkhxLu9pdS7uSVt+yK8drSZa02s9f387s+iNSHszO7JuZ936/9zEMKyQMQwRBwNcN00Sz2UKv18fBQeV8PxqrhF0+cHkEvscPqJqG+dzma0VVlwy+aphd3ghjVNHXiw/oDRM7O1nk8gXI5TLXeZ7HGawyypY8ug4w/A/EE+PSHpTcLlzSLxYLKIoKyzq9EprXIozE1YoIigUom4/xz8ZD5J//BVfeQ1DTBHI6u5PNoiRJqNXrVwwvIbQz60CljHa/hR8yX+D+7if4bfM7QbHTgCvl4RBViWhHaKNEtVpt4Si4QMoNuso+3F6LK8y2gQfpz/BQ+hS/pr+BZ8dxPexiUshArlThui5Ms4lOpxsbvIgnC0YWHDKYyOFgiKepX/Bn9ntsZTcTTmJqN3C0nYJm1JFKpXFiWUu0mVevAqcv+c/ZZMLjk8hgcATdMDgl33UFmgad75p8vb+/D9u24TjOuVHmH0hoKGWUqWhT6Q1+IBI/EIVTLJaQLxR4DUYOI7GLu8DYwmg6w/p6CqqqodUW8WQnO2lCJfMfuaxgEl9KKKjaAa+76WwGWRZ16C9shHIB3W4X7U5HOC5JODs7AxvntlCq6LDnc1KWMJ1OxSXf53NZUdDr93kS6vWG2OPB7uIol4FGuiRUUbKYrxZhzWxI5OH4+DiuNxFDzw/wguJUrep8rlCGE4lyH9DdQ0JYJsoJEOaUcita3IHv2dCrKo5fnpxra4Rm0G/CW8QsDOrt8dXOYZ6uwiP4otpCjEYj3P5cxfUPinjyt8i463qUpJDj+urbDbzxnoQv7ylUHQM4usbvJu8Ai3rXeZEhryL1P62pYG8PwW4AH9/Vo5wSdYFgPh3jzfdp/x3g2s0aeiZlVpcRXjbI43F6Aju/TR6HqBldvPVRB+zWEX5cE/Xmh0DSrXe+NsDetfDh3SbchgrfNAS3c4TxgiOtEg1DRjv1L6TnW/TEjBFGJWLPEUypnKwhnLqK3d+fYLK3jbAqLT1h8eMQXGSPMovFDGhVMX/2CPO1n/mwn/2BRTYNn9oPLu2Tg3DFa/M/CRaFZ/SkJakAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Tree2\"\n        title=\"\"\n        src=\"/static/15dd73d757e4a334523bd289bd377c0a/b4624/tree2.png\"\n        srcset=\"/static/15dd73d757e4a334523bd289bd377c0a/563d8/tree2.png 200w,\n/static/15dd73d757e4a334523bd289bd377c0a/7c2ef/tree2.png 400w,\n/static/15dd73d757e4a334523bd289bd377c0a/b4624/tree2.png 760w\"\n        sizes=\"(max-width: 760px) 100vw, 760px\"\n      />\n  </span>\n  </a></p>\n<p>Context를 생성하고, 해당 Context의 value(어떤 데이터(store, state 등)를 사용할 지)를 정합니다.\n빨간색의 원 구역만큼의 트리를 해당 Context의 Provider로 감싸주면, Provider의 영역 안에 있는 컴포넌트라면 어떤 컴포넌트든 Context의 Consumer를 통해 Context의 value를 구독할 수 있습니다.(Hook의 useContext로 Consumer를 대체할 수 있음)\n즉, 초록색과 파란색 사이의 컴포넌트는 건너 뛰고 파란색 컴포넌트들에서 바로 Consumer(or useContext)를 이용하여 Context의 value를 사용할 수 있습니다.</p>\n<hr>\n<h2>MobX with Hooks</h2>\n<h3>Hook을 지원하는 mobx-react-lite가 mobx-react에 v6 부터 내장되었습니다.</h3>\n<h3>설치</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install mobx mobx-react-lite(or ~v6 mobx-react)\nor\nyarn add mobx mobx-react-lite(or ~v6 mobx-react)</code></pre></div>\n<h3>Store 구현 코드</h3>\n<p>다음과 같이 Store를 구현합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// ~store/tokenStore.tsx\n\nexport type TToken = {\n  symbol: string,\n  balance: number\n}\n\nexport function tokenStore() {\n  return {\n    tokenList: [{symbol: &quot;BTC&quot;, balance: 0}] as TToken[],\n    addToken(token: TToken) {\n      this.tokenList = [...this.tokenList, token];\n    },\n    get totalBalance() {\n      return this.tokenList.reduce((prev, current) =&gt; {\n        return prev + current.balance\n      }, 0);\n    }\n  };\n}\n\nexport type TTokenStore = ReturnType&lt;typeof tokenStore&gt;</code></pre></div>\n<h3>Context 구현 코드</h3>\n<p>위에서 구현한 Store를 mobx-react-lite의 useLocalStore를 사용하여 진짜 Store로 만들고, 생성한 Context Provider value에 넣어줍니다.</p>\n<p>useLocalStore는 내부 리소스를 observable 하게 만들어 줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// ~store/useTokenStore.tsx\n\nimport React from &#39;react&#39;\nimport { tokenStore, TTokenStore } from &#39;./tokenStore&#39;\nimport { useLocalStore } from &#39;mobx-react-lite&#39;\n\nconst tokenStoreContext = React.createContext&lt;TTokenStore | null&gt;(null);\n\ninterface ITokenStoreProvider {\n  children: JSX.Element\n};\n\nexport const TokenStoreProvider = (props: ITokenStoreProvider) =&gt; {\n  const store = useLocalStore(tokenStore);\n\n  return (\n    &lt;tokenStoreContext.Provider value={store}&gt;\n      {props.children}\n    &lt;/tokenStoreContext.Provider&gt;\n  );\n};\n\nexport const useTokenStore = () =&gt; {\n  const store = React.useContext(tokenStoreContext);\n\n  if (!store) {\n    throw new Error(&#39;You have forgot to use StoreProvider, shame on you.&#39;);\n  }\n\n  return store;\n};</code></pre></div>\n<h3>Store 생성 코드</h3>\n<p>다음과 같이 useTokenStore()를 호출하여 구현해 놓은 Store를 생성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import { useTokenStore } from &quot;../store/useTokenStore&quot;;\nimport { useObserver } from &quot;mobx-react-lite&quot;;\n\nconst TokenComponent = () =&gt; {\n  const store = useTokenStore();\n\n  return useObserver(() =&gt; (\n    ...\n  ));\n}</code></pre></div>\n<h3>Store Provider</h3>\n<p>마지막으로, 위에서처럼 TokenComponent 에서 (내부에 useContext(tokenStoreContext)로 구현되어 있는) useTokenStore를 사용할 수 있으려면, TokenComponent를 (내부에 tokenStoreContext.Provider로 구현되어 있는) TokenStoreProvider로 감싸줘야합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import { TokenStoreProvider } from &quot;../store/useTokenStore&quot;;\n\nexport const App = () =&gt; {\n  return (\n    &lt;TokenStoreProvider&gt;\n      &lt;TokenComponent /&gt;\n    &lt;/TokenStoreProvider&gt;\n  )\n}</code></pre></div>\n<blockquote>\n<p>잠깐, Store를 생성할 때, inject 없이 useTokenStore()로 생성하네요?</p>\n</blockquote>\n<p>store injection pattern은 React에 Context API 가 도입되기 이전의 Legacy Context를 사용하기에 불편한 점이 많아 도입되었으며, mobx-react 라이브러리에 의해 대중화되었습니다.</p>\n<p>하지만, 지금은 Context API 등 Legacy Context를 대체할 수 있는 더 좋은 툴이 많기 때문에, mobx-react 공식문서에서는 injection pattern을 obsolete(더 이상 쓸모 없는)한 것으로 간주하고 migration 할 것을 권장하고 있습니다.</p>\n<blockquote>\n<p>그러고보니 observable, computed, action 등도 안보이네요?</p>\n</blockquote>\n<p>현재 mobx-react-lite에 useObservable, useComputed 가 내장되어 있지만, github mobx-react-lite repo를 보면 이 둘 대신에 useLocalStore를 사용하라고 합니다. (곧 없어질 것 같네요.)</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bef4a1c00ecc2d8c1c19494257b5dd18/70bf2/image1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 18.201284796573873%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAA40lEQVQY02WP2WqEUBBE/f+/Ctke1FHHGaKOjvss1yVk3BU8uZFAHtJQ0F0Fp2glimMM0+JwPBInCUmaYtk2fhAQRtHm+cEZx3U5hyHeyWdvH3C9E1GcUNX15hdliSgKFFXTeXp+4fXtHdOy+HDc7Tbk7njeBjatPbphSIiHvtNRVRXD2KHpGmmWEUhgkmaUVYUyzwvjNDGOE/Oy8GjabX80DU3bblnb9XQ/6ke6GYYFvgboJ/6NUtWfXG8CIUruopBvpLItl80XYtla/+ZZfuVeVCRiIC9H/EvPreokYmVd//QNVX8nRy4dX8AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"image1\"\n        title=\"\"\n        src=\"/static/bef4a1c00ecc2d8c1c19494257b5dd18/67d59/image1.png\"\n        srcset=\"/static/bef4a1c00ecc2d8c1c19494257b5dd18/563d8/image1.png 200w,\n/static/bef4a1c00ecc2d8c1c19494257b5dd18/7c2ef/image1.png 400w,\n/static/bef4a1c00ecc2d8c1c19494257b5dd18/67d59/image1.png 800w,\n/static/bef4a1c00ecc2d8c1c19494257b5dd18/70bf2/image1.png 934w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fe62c3cb4a551dd5d7a5f725150b104d/038c9/image2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 11.944091486658195%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAeklEQVQI1yWL2w6DIABD/f8PnHjdRXETWLKBCDMmZ4gPTZv2tJiVohQCUdc0bUfX9xydNgZjNErNiKpiGCV103IpT7a/3tLv7A9+lBPWOQprHXJ6Zt0fQx6U1gkyvN4eqT2fryXGiPcetywsyf265hxCYNu2tP/Y950/dyiVIEG791cAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"image2\"\n        title=\"\"\n        src=\"/static/fe62c3cb4a551dd5d7a5f725150b104d/67d59/image2.png\"\n        srcset=\"/static/fe62c3cb4a551dd5d7a5f725150b104d/563d8/image2.png 200w,\n/static/fe62c3cb4a551dd5d7a5f725150b104d/7c2ef/image2.png 400w,\n/static/fe62c3cb4a551dd5d7a5f725150b104d/67d59/image2.png 800w,\n/static/fe62c3cb4a551dd5d7a5f725150b104d/f6e31/image2.png 1200w,\n/static/fe62c3cb4a551dd5d7a5f725150b104d/038c9/image2.png 1574w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<p>useLocalStore는 Component instance 당 한 번만 생성되며, 재생성 되도록 강제할 수 없습니다.</p>\n<p>또한, 위의 예제처럼 React Context의 도움을 받아 component tree를 이동하며 전역 상태로 관리될 수 있습니다.</p>\n<hr>\n<h2>Reference</h2>\n<ul>\n<li><a href=\"https://boxfoxs.tistory.com/395\">https://boxfoxs.tistory.com/395</a></li>\n<li><a href=\"https://github.com/mobxjs/mobx-react\">https://github.com/mobxjs/mobx-react</a></li>\n<li><a href=\"https://github.com/mobxjs/mobx-react-lite\">https://github.com/mobxjs/mobx-react-lite</a></li>\n<li><a href=\"https://mobx-react.js.org/\">https://mobx-react.js.org/</a></li>\n<li><a href=\"https://dev.to/davidyushkov/mobx-and-react-hooks-getting-started-4ff2\">https://dev.to/davidyushkov/mobx-and-react-hooks-getting-started-4ff2</a></li>\n<li><a href=\"https://blog.rhostem.com/posts/2019-07-22-mobx-v6-and-react-v16-8\">https://blog.rhostem.com/posts/2019-07-22-mobx-v6-and-react-v16-8</a></li>\n</ul>","excerpt":"리액트가 변하고 있다(?) React 가 Hook을 내장시킴에 따라 많은 라이브러리들이 Hooks API 를 지원하고 있습니다. 어차피 5-6개월 있으면 또 새로운 거 나와서 다시 새로 배워야 되는거 아냐?\n도대체 Hook이 뭔데? Hook…"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"type":"posts","next":null,"previous":{"frontmatter":{"path":"/react/2","title":"Server Side Rendering과 Store Injection","tags":["react","ssr","next.js","web"]},"fileAbsolutePath":"/Users/soopark/Documents/dev/github-blog/src/posts/react/Server Side Rendering과 Store Injection/index.md"}}}